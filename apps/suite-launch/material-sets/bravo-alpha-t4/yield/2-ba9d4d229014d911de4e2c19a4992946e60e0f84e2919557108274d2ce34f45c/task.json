{
    "family": "bravo-alpha-t4-r2-ba9d4d",
    "executionRoleArn": "arn:aws:iam::210752607241:role/ecsTaskExecutionRole",
    "taskRoleArn": "arn:aws:iam::210752607241:role/FirelensECS",
    "networkMode": "bridge",
    "containerDefinitions": [
      {
        "name": "fluent-bit",
        "image": "210752607241.dkr.ecr.us-west-2.amazonaws.com/amazon/aws-for-fluent-bit:2.31.2-tls-options",
        "command": ["/bin/bash", "-c", "/init/fluent_bit_init_process; chmod +x /init/invoke_fluent_bit.sh; cd /cores; export RANDOM_ID_VALUE=$(($RANDOM%99999))$(($RANDOM%99999))$(($RANDOM%99999)); echo 'RANDOM_ID is set to $RANDOM_ID_VALUE'; env RANDOM_ID=$RANDOM_ID_VALUE /init/invoke_fluent_bit.sh; echo $RANDOM_ID; ls /cores; mv `ls /cores` ${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.core; zip /cores/core.zip *; aws s3 cp /cores/core.zip s3://${S3_BUCKET}/${S3_KEY_PREFIX}/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.zip; aws s3 cp /cores/core.zip s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-all/cores/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.zip; aws s3 cp /cores/core.zip s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-by-date/`date +%Y-%m-%d`/cores/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.zip; aws s3 cp /cores/core.zip s3://${S3_ALTERNATE_LOCATION_PREFIX}-${RANDOM_ID_VALUE}.zip; gdb -batch -ex 'thread apply all bt full' -ex 'quit' '/fluent-bit/bin/fluent-bit' ${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.core > '/cores/stacktrace'; aws s3 cp /cores/stacktrace s3://${S3_BUCKET}/${S3_KEY_PREFIX}/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.stacktrace; aws s3 cp /cores/stacktrace s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-all/stacktraces/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.stacktrace; aws s3 cp /cores/stacktrace s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-by-date/`date +%Y-%m-%d`/stacktraces/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.stacktraces; aws s3 cp /cores/stacktrace s3://${S3_ALTERNATE_LOCATION_PREFIX}-${RANDOM_ID_VALUE}.stacktrace; aws s3 cp /fluent-bit/bin/fluent-bit s3://${S3_BUCKET}/${S3_KEY_PREFIX}/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.executable; aws s3 cp /fluent-bit/bin/fluent-bit s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-all/executables/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.executable; aws s3 cp /fluent-bit/bin/fluent-bit s3://${S3_BUCKET}/bravo/bravo-alpha-t1/error-reports-by-date/`date +%Y-%m-%d`/executables/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.executable; aws s3 cp /fluent-bit/bin/fluent-bit s3://${S3_BUCKET}/${S3_KEY_PREFIX}/${S3_FILE_NAME_PREFIX}-${RANDOM_ID_VALUE}.executable; aws s3 cp /fluent-bit/bin/fluent-bit s3://${S3_ALTERNATE_LOCATION_PREFIX}-${RANDOM_ID_VALUE}.executable; "],
        "cpu": 512,
        "firelensConfiguration": {
          "type": "fluentbit"
        },
        "environmentFiles": [
          {
              "value": "arn:aws:s3:::aws-for-fluent-bit-stability-test-collections/bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/fluent-bit.env",
              "type": "s3"
          }
        ],
        "environment": [
          {
            "name": "AWS_REGION",
            "value": "us-west-2"
          },
          {
            "name": "aws_fluent_bit_init_s3_1",
            "value": "arn:aws:s3:::aws-for-fluent-bit-stability-test-collections/bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/fluent-bit.conf"
          },
          {
            "name": "aws_fluent_bit_init_s3_2",
            "value": "arn:aws:s3:::aws-for-fluent-bit-stability-test-collections/bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/fluent-bit-one-box.conf"
          },
          {
            "name": "aws_fluent_bit_init_s3_3",
            "value": "arn:aws:s3:::aws-for-fluent-bit-stability-test-collections/bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/fluent-parser.conf"
          },
          {
            "name": "S3_BUCKET",
            "value": "aws-for-fluent-bit-stability-test-corefiles"
          },
          {
            "name": "S3_KEY_PREFIX",
            "value": "bravo-alpha-t4/r2-ba9d4d"
          },
          {
            "name": "S3_FILE_NAME_PREFIX",
            "value": "bravo-alpha-t4-r2-ba9d4d"
          },
          {
            "name": "S3_ALTERNATE_LOCATION_PREFIX",
            "value": "aws-for-fluent-bit-stability-test-collections/bravo-alpha-t4/error-reports/bravo-alpha-t4-r2-ba9d4d"
          }
        ],
        "memory": 512,
        "essential": true,
        "logConfiguration": {
          "logDriver": "awslogs",
          "options": {
            "awslogs-group": "app-bravo-alpha-t4-r2-ba9d4d",
            "awslogs-region": "us-west-2",
            "awslogs-create-group": "true",
            "awslogs-stream-prefix": "fluent-bit"
          }
        },
        "mountPoints": [
          {
            "sourceVolume": "my-shared-volume",
            "containerPath": "/tmp/data_logs",
            "readOnly": false
          }
        ],
        "links": ["mock:mock"]
      },
      {
        "name": "datajet",
        "user": "0",
        "image": "210752607241.dkr.ecr.us-west-2.amazonaws.com/datajet:s3-client",
        "essential": true,
        "environment": [
          {
            "name": "CLIENTS",
            "value": "[\"s3\"]"
          },
          {
              "name": "CLIENT_S3_BUCKET",
              "value": "aws-for-fluent-bit-stability-test-collections"
          },
          {
            "name": "CLIENT_S3_FILE",
            "value": "bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/firelens-datajet.json"
          }
        ],
        "logConfiguration": {
            "logDriver": "awslogs",
            "options": {
                "awslogs-group": "app-bravo-alpha-t4-r2-ba9d4d",
                "awslogs-region": "us-west-2",
                "awslogs-create-group": "true",
                "awslogs-stream-prefix": "datajet"
            }
        },
        "mountPoints": [
          {
            "sourceVolume": "my-shared-volume",
            "containerPath": "/var/tmp/data_logs",
            "readOnly": false
          }
        ],
        "dependsOn": [{
            "containerName": "fluent-bit",
            "condition": "START"
        }],
        "links": ["fluent-bit:flb"]
      },
      {
        "essential": false,
        "image": "httpd",
        "name": "dummy",
        "logConfiguration": {
          "logDriver":"awsfirelens",
          "options": {
            "Name": "cloudwatch_logs",
            "region": "us-west-2",
            "log_group_name": "/aws/ecs/containerinsights/dummy-app",
            "auto_create_group": "true",
            "log_stream_name": "stdout-stderr-",
            "retry_limit": "2"
          }
        },
        "memoryReservation": 100
      },
      {
        "essential": false,
        "image": "210752607241.dkr.ecr.us-west-2.amazonaws.com/mock-mountebank:0.0.1",
        "name": "mock",
        "environment": [
          {
              "name": "CLIENT_S3_BUCKET",
              "value": "aws-for-fluent-bit-stability-test-collections"
          },
          {
            "name": "CLIENT_S3_FILE",
            "value": "bravo-alpha-t4/yield/2-ba9d4d229014d911de4e2c19a4992946e60e0f84e2919557108274d2ce34f45c/mountebank.json"
          }
        ],
        "logConfiguration": {
          "logDriver": "awslogs",
            "options": {
                "awslogs-group": "app-bravo-alpha-t4-r2-ba9d4d",
                "awslogs-region": "us-west-2",
                "awslogs-create-group": "true",
                "awslogs-stream-prefix": "mock"
            }
        },
        "memoryReservation": 100
      }
    ],
    "memory": "512",
    "cpu": "512",
    "volumes": [
      {
        "name": "my-shared-volume"
      }
    ]
}
